@model ProcessManagement.Models.Group
@{
    ViewBag.Title = Model.Name;
    Session["groupid"] = Model.Id;
    var group = Model;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var listprocess = ViewData["ListProcess"] as List<ProcessManagement.Models.Process>;
    //var listuser = ViewData["ListParticipant"] as List<ProcessManagement.Models.Participate>;
    var statistic = ViewData["Statistic"] as dynamic;
    var userRole = ViewData["UserRoles"] as ProcessManagement.Models.Participate;
    var isOwnerOrAdmin = userRole.IsOwner || userRole.IsAdmin ? "" : "disabled";
    var files = ViewData["Files"] as List<ProcessManagement.Models.FileManager>;
    var maxFileSizeRule = ViewData["FileMaxSize"] as ProcessManagement.Models.ConfigRule;
}
@section CustomCss{
    <link rel="stylesheet" href="~/Content/vendor/chartist/css/chartist.min.css">
    <link rel="stylesheet" href="~/Content/vendor/chartist-plugin-tooltip/chartist-plugin-tooltip.css">
    <link rel="stylesheet" href="~/Content/vendor/select2/select2.css" />
    <link rel="stylesheet" href="~/Content/vendor/bootstrap-multiselect/bootstrap-multiselect.css">
    <link href="~/Content/vendor/jquery-confirm/dist/jquery-confirm.min.css" rel="stylesheet" />
    <style>
        .dropdown-menu a {
            display: block;
        }

        .dropdown-menu > .active > a, .dropdown-menu > .active > a:hover, .dropdown-menu > .active > a:focus {
            background-color: unset !important;
        }

        .multiselect-container > li > a > label {
            padding: 6px 6px 6px 30px;
        }
    </style>
}
<div class="block-header">
    <div class="row">
        <div class="col-lg-6 col-md-8 col-sm-12">
            <h2>
                <a href="javascript:void(0);" class="btn btn-xs btn-link primary-theme btn-toggle-fullwidth primary-theme">
                    <i class="fa fa-arrow-left"></i>
                </a> @Model.Name
            </h2>
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="~/Home/Index" class="primary-theme"><i class="icon-home"></i></a></li>
                <li class="breadcrumb-item"><a href="/" class="primary-theme">Groups</a></li>
                <li class="breadcrumb-item"><a href="" class="primary-theme">@Model.Name</a></li>
            </ul>
        </div>
        <div class="col-lg-6 col-md-4 col-sm-12 text-right">
            <div class="bh_chart hidden-xs">
                <div class="float-left m-r-15">
                    <small>Visitors</small>
                    <h6 class="mb-0 mt-1"><i class="icon-user"></i> 1,784</h6>
                </div>
                <span class="bh_visitors float-right">2,5,1,8,3,6,7,5</span>
            </div>
            <div class="bh_chart hidden-sm">
                <div class="float-left m-r-15">
                    <small>Visits</small>
                    <h6 class="mb-0 mt-1"><i class="icon-globe"></i> 325</h6>
                </div>
                <span class="bh_visits float-right">10,8,9,3,5,8,5</span>
            </div>
            <div class="bh_chart hidden-sm">
                <div class="float-left m-r-15">
                    <small>Chats</small>
                    <h6 class="mb-0 mt-1"><i class="icon-bubbles"></i> 13</h6>
                </div>
                <span class="bh_chats float-right">1,8,5,6,2,4,3,2</span>
            </div>
        </div>
    </div>
</div>

<div class="row clearfix display-flex">
    <div class="col-lg-3 col-md-6" style="height:100%">
        <div class="card top_counter">
            <div class="body">
                <div class="icon"><i class="fa fa-users"></i> </div>
                <div class="content">
                    <div class="text">Member</div>
                    <h5 class="number">@statistic.totalmember</h5>
                </div>
                <hr>
                <div class="icon">
                    <object width="40" height="50" type="image/svg+xml" data="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNNDQ1LjY2LDQ5LjM0MUgzNDAuMjA2TDI5NC4wMDgsMy4xNDNjLTQuMTkyLTQuMTkxLTEwLjk5LTQuMTkxLTE1LjE4MywwbC00OS4zNDEsNDkuMzQyCgkJCWMtNC4xOTIsNC4xOTItNC4xOTIsMTAuOTksMCwxNS4xODNsNDYuMTk4LDQ2LjE5OHYzOC40OTRoLTgwLjUxNmMtNS45MjksMC0xMC43MzYsNC44MDYtMTAuNzM2LDEwLjczNXYyMS40NzFoLTQyLjk0MnYtMjEuNDcxCgkJCWMwLTUuOTI5LTQuODA2LTEwLjczNS0xMC43MzYtMTAuNzM1SDY2LjM0Yy01LjkyOSwwLTEwLjczNSw0LjgwNi0xMC43MzUsMTAuNzM1djY0LjQxM2MwLDUuOTI5LDQuODA2LDEwLjczNSwxMC43MzUsMTAuNzM1CgkJCWgyMC43NTV2OTMuNzk4YzAsNS45MjksNC44MDYsMTAuNzM2LDEwLjczNSwxMC43MzZoOTUuNDM3bC0xMC4zNDYsMTAuMzQ2Yy00LjE5Miw0LjE5Mi00LjE5MywxMC45OSwwLDE1LjE4MgoJCQljMi4wOTcsMi4wOTcsNC44NDQsMy4xNDQsNy41OTEsMy4xNDRjMi43NDcsMCw1LjQ5NS0xLjA0OSw3LjU5MS0zLjE0NGwxNS4wNjEtMTUuMDYxYzMuOTk0LDguODMsMTAuNTIxLDE2Ljg1OSwxOS4zMTEsMjMuNTQKCQkJYzExLjkzMiw5LjA2OCwyNi45ODcsMTQuNzgzLDQzLjIwNSwxNi41Mzl2MzIuNzkyaC00Mi45NDJjLTUuOTI5LDAtMTAuNzM1LDQuODA2LTEwLjczNSwxMC43MzZ2NjQuNDEzCgkJCWMwLDUuOTI5LDQuODA2LDEwLjczNSwxMC43MzUsMTAuNzM1aDEwNy4zNTVjNS45MjksMCwxMC43MzUtNC44MDYsMTAuNzM1LTEwLjczNXYtNjQuNDEzYzAtNS45MjktNC44MDYtMTAuNzM2LTEwLjczNS0xMC43MzYKCQkJaC00Mi45NDJ2LTMyLjc5MmMxNi4yMTgtMS43NTYsMzEuMjcyLTcuNDcxLDQzLjIwNS0xNi41MzljOC44MDEtNi42ODksMTUuMzMyLTE0LjczLDE5LjMyNS0yMy41NzJsMTUuMDkyLDE1LjA5MgoJCQljMi4wOTcsMi4wOTcsNC44NDQsMy4xNDQsNy41OTEsMy4xNDRzNS40OTUtMS4wNDksNy41OTEtMy4xNDRjNC4xOTItNC4xOTIsNC4xOTItMTAuOTksMC0xNS4xODJsLTEwLjM0Ni0xMC4zNDZoNjYuMDUKCQkJYzUuOTI5LDAsMTAuNzM2LTQuODA2LDEwLjczNi0xMC43MzZWNjAuMDc3QzQ1Ni4zOTYsNTQuMTQ4LDQ1MS41ODksNDkuMzQxLDQ0NS42Niw0OS4zNDF6IE0yNTIuMjU3LDYwLjA3OGwzNC4xNi0zNC4xNgoJCQlsMzQuMTYsMzQuMTZsLTM0LjE2LDM0LjE2TDI1Mi4yNTcsNjAuMDc4eiBNMjA1LjkwMSwxNzMuODMyaDE2MS4wMzJ2NDIuOTQySDIwNS45MDFWMTczLjgzMnogTTc3LjA3NSwyMTYuNzc0di00Mi45NDJoNDIuOTQyCgkJCXY0Mi45NDJINzcuMDc1eiBNMjEzLjI0OSwzMTAuOTIybC0xNS4xNDMtMTUuMTQzYy00LjE5Mi00LjE5Mi0xMC45OS00LjE5Mi0xNS4xODMsMGMtNC4xOTIsNC4xOTItNC4xOTIsMTAuOTksMCwxNS4xODMKCQkJbDEwLjM0NiwxMC4zNDZoLTg0LjcwMnYtODMuMDYzaDIyLjE4N2M1LjkyOSwwLDEwLjczNS00LjgwNiwxMC43MzUtMTAuNzM1di0yMS40NzFoNDIuOTQydjIxLjQ3MQoJCQljMCw1LjkyOSw0LjgwNiwxMC43MzUsMTAuNzM1LDEwLjczNWg4MC41MTZ2MzIuNzkyYy0xNi4yMTgsMS43NTYtMzEuMjcyLDcuNDcxLTQzLjIwNSwxNi41MzkKCQkJQzIyMy43NSwyOTQuMjA4LDIxNy4yNSwzMDIuMTY4LDIxMy4yNDksMzEwLjkyMnogTTMyOS4zNTksNDQ3LjU4N3Y0Mi45NDJoLTg1Ljg4NHYtNDIuOTQySDMyOS4zNTl6IE0yODYuNDE3LDM3Mi40MzkKCQkJYy0zMS4wNzgsMC01Ni4zNjEtMTguMDU5LTU2LjM2MS00MC4yNThzMjUuMjgzLTQwLjI1OCw1Ni4zNjEtNDAuMjU4YzMxLjA3OCwwLDU2LjM2MSwxOC4wNTksNTYuMzYxLDQwLjI1OAoJCQlTMzE3LjQ5NiwzNzIuNDM5LDI4Ni40MTcsMzcyLjQzOXogTTM3OS42MSwzMjEuMzA4bDEwLjM0Ny0xMC4zNDZjNC4xOTItNC4xOTIsNC4xOTItMTAuOTksMC0xNS4xODMKCQkJYy00LjE5Mi00LjE5MS0xMC45OS00LjE5MS0xNS4xODMsMGwtMTUuMTc1LDE1LjE3NWMtNC04Ljc2Ni0xMC41MDUtMTYuNzM4LTE5LjI0Mi0yMy4zNzgKCQkJYy0xMS45MzItOS4wNjgtMjYuOTg3LTE0Ljc4My00My4yMDUtMTYuNTM5di0zMi43OTJoODAuNTE2YzUuOTI5LDAsMTAuNzM1LTQuODA2LDEwLjczNS0xMC43MzV2LTY0LjQxMwoJCQljMC01LjkyOS00LjgwNi0xMC43MzUtMTAuNzM1LTEwLjczNWgtODAuNTE2di0zOC40OTRsNDMuMDU0LTQzLjA1NGg5NC43MTh2MjUwLjQ5NEgzNzkuNjF6Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+">
                        fallback
                    </object>
                </div>
                <div class="content">
                    <div class="text">Total Process</div>
                    <h5 class="number">@statistic.totalprocess</h5>
                </div>
            </div>
        </div>
        <div class="card top_counter">
            <div class="body">
                <div class="icon">
                    <object width="30" height="50" type="image/svg+xml" data="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQ4N3B0IiB2aWV3Qm94PSIwIC00IDQ4Ny4yMzQxMiA0ODciIHdpZHRoPSI0ODdwdCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMzkyLjA0Mjk2OSAzMDQuMTE3MTg4Yy00OC42MDE1NjMgMC04OCAzOS4zOTg0MzctODggODggMCA0OC42MDE1NjIgMzkuMzk4NDM3IDg4IDg4IDg4IDQ4LjYwMTU2MiAwIDg4LTM5LjM5ODQzOCA4OC04OC0uMDU4NTk0LTQ4LjU3ODEyNi0zOS40MjE4NzUtODcuOTQxNDA3LTg4LTg4em0wIDE2MGMtMzkuNzY1NjI1IDAtNzItMzIuMjM0Mzc2LTcyLTcyIDAtMzkuNzY1NjI2IDMyLjIzNDM3NS03MiA3Mi03MnM3MiAzMi4yMzQzNzQgNzIgNzJjLS4wNDI5NjkgMzkuNzQ2MDkzLTMyLjI1MzkwNyA3MS45NTcwMzEtNzIgNzJ6bTAgMCIvPjxwYXRoIGQ9Im0xNjguMDQyOTY5IDMwNC4xMTcxODhoLTcydi04NC42ODc1bDIzLjYwMTU2MiAyMy41OTc2NTZjMy4xMzY3MTkgMy4wMzUxNTYgOC4xMjg5MDcgMi45ODgyODEgMTEuMjE0ODQ0LS4wOTc2NTYgMy4wODU5MzctMy4wODIwMzIgMy4xMjg5MDYtOC4wNzQyMTkuMDk3NjU2LTExLjIxMDkzOGwtMzcuMjU3ODEyLTM3LjI1NzgxMmMtMy4xMjUtMy4xMjEwOTQtOC4xODc1LTMuMTIxMDk0LTExLjMxMjUgMGwtMzcuMjUzOTA3IDM3LjI1NzgxMmMtMy4wMzEyNSAzLjEzNjcxOS0yLjk4ODI4MSA4LjEyODkwNi4wOTc2NTcgMTEuMjEwOTM4IDMuMDg1OTM3IDMuMDg1OTM3IDguMDc0MjE5IDMuMTMyODEyIDExLjIxNDg0My4wOTc2NTZsMjMuNTk3NjU3LTIzLjU5NzY1NnY4NC42ODc1aC03MmMtNC40MTc5NjkgMC04LjAwMDAwMDIgMy41ODIwMzEtOC4wMDAwMDAyIDh2MTYwYzAgNC40MTc5NjggMy41ODIwMzEyIDggOC4wMDAwMDAyIDhoMTYwYzQuNDE3OTY5IDAgOC0zLjU4MjAzMiA4LTh2LTE2MGMwLTQuNDE3OTY5LTMuNTgyMDMxLTgtOC04em0tOCAxNjBoLTE0NHYtMTQ0aDE0NHptMCAwIi8+PHBhdGggZD0ibTI0MC40NDUzMTIgNDUuMjAzMTI1Yy0yLjAxMTcxOC0yLjA3ODEyNS00Ljk4NDM3NC0yLjkxMDE1Ni03Ljc4MTI1LTIuMTc5Njg3LTIuNzk2ODc0LjczMDQ2OC00Ljk4MDQ2OCAyLjkxNzk2OC01LjcxNDg0MyA1LjcxNDg0My0uNzMwNDY5IDIuNzk2ODc1LjEwMTU2MiA1Ljc2OTUzMSAyLjE4MzU5MyA3Ljc3NzM0NGwyMy41OTc2NTcgMjMuNjAxNTYzaC03Ny4wOTM3NWMtNC4yNzczNDQtNDYuODQ3NjU3LTQ0LjY0NDUzMS04Mi4wNTA3ODItOTEuNjQwNjI1LTc5LjkxMDE1N3MtODMuOTk2MDk0IDQwLjg2NzE4OC04My45OTYwOTQgODcuOTEwMTU3YzAgNDcuMDQyOTY4IDM3IDg1Ljc2OTUzMSA4My45OTYwOTQgODcuOTEwMTU2czg3LjM2MzI4MS0zMy4wNjI1IDkxLjY0MDYyNS03OS45MTAxNTZoNzcuMDkzNzVsLTIzLjU5NzY1NyAyMy42MDE1NjJjLTIuMDgyMDMxIDIuMDA3ODEyLTIuOTE0MDYyIDQuOTgwNDY5LTIuMTgzNTkzIDcuNzc3MzQ0LjczNDM3NSAyLjc5Njg3NSAyLjkxNzk2OSA0Ljk4MDQ2OCA1LjcxNDg0MyA1LjcxNDg0NCAyLjc5Njg3Ni43MzA0NjggNS43Njk1MzItLjEwMTU2MyA3Ljc4MTI1LTIuMTgzNTk0bDM3LjI1MzkwNy0zNy4yNTM5MDZjMy4xMjUtMy4xMjUgMy4xMjUtOC4xODc1IDAtMTEuMzEyNXptLTE1Mi40MDIzNDMgMTE0LjkxNDA2M2MtMzkuNzY1NjI1IDAtNzItMzIuMjM0Mzc2LTcyLTcyIDAtMzkuNzY1NjI2IDMyLjIzNDM3NS03MiA3Mi03MnM3MiAzMi4yMzQzNzQgNzIgNzJjLS4wNDI5NjkgMzkuNzQ2MDkzLTMyLjI1MzkwNyA3MS45NTcwMzEtNzIgNzJ6bTAgMCIvPjxwYXRoIGQ9Im00ODQuMzAwNzgxIDgxLjkyNTc4MS04Ny4yMDMxMjUtNzEuMTk5MjE5Yy0yLjk0NTMxMi0yLjQxMDE1Ni03LjE3OTY4Ny0yLjQxMDE1Ni0xMC4xMjUgMGwtODcuMTk5MjE4IDcxLjE5OTIxOWMtMS44NTkzNzYgMS41MTk1MzEtMi45Mzc1IDMuNzkyOTY5LTIuOTM3NSA2LjE5MTQwNyAwIDIuMzk4NDM3IDEuMDc4MTI0IDQuNjcxODc0IDIuOTM3NSA2LjE5MTQwNmw4NC4yNjk1MzEgNjguODAwNzgxdjk3LjY5NTMxM2wtMjMuNTk3NjU3LTIzLjYwMTU2M2MtMy4xNDA2MjQtMy4wMzEyNS04LjEyODkwNi0yLjk4ODI4MS0xMS4yMTQ4NDMuMDk3NjU2LTMuMDg1OTM4IDMuMDg1OTM4LTMuMTI4OTA3IDguMDc4MTI1LS4wOTc2NTcgMTEuMjE0ODQ0bDM3LjI1MzkwNyAzNy4yNTc4MTNjMy4xMjUgMy4xMjEwOTMgOC4xODc1IDMuMTIxMDkzIDExLjMxMjUgMGwzNy4yNTc4MTItMzcuMjU3ODEzYzMuMDMxMjUtMy4xMzY3MTkgMi45ODgyODEtOC4xMjg5MDYtLjA5NzY1Ni0xMS4yMTQ4NDQtMy4wODU5MzctMy4wODU5MzctOC4wNzgxMjUtMy4xMjg5MDYtMTEuMjE0ODQ0LS4wOTc2NTZsLTIzLjYwMTU2MiAyMy42MDE1NjN2LTk3LjY5NTMxM2w4NC4yNTc4MTItNjguODAwNzgxYzEuODU1NDY5LTEuNTE5NTMyIDIuOTMzNTk0LTMuNzkyOTY5IDIuOTMzNTk0LTYuMTkxNDA2IDAtMi4zOTg0MzgtMS4wNzgxMjUtNC42NzE4NzYtMi45MzM1OTQtNi4xOTE0MDd6bS05Mi4yNTc4MTIgNjcuMDU0Njg4LTc0LjU0Mjk2OS02MC44NjMyODEgNzQuNTQyOTY5LTYwLjg2MzI4MiA3NC41NDI5NjkgNjAuODYzMjgyem0wIDAiLz48L3N2Zz4=">
                        fallback
                    </object>
                </div>
                <div class="content">
                    <div class="text">Active Process</div>
                    <h5 class="number">$2.8M</h5>
                </div>
                <hr>
                <div class="icon"><i class="fa fa-university"></i> </div>
                <div class="content">
                    <div class="text">Avg. Salary</div>
                    <h5 class="number">$1,250</h5>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card text-center" style="height:100%">
            <div class="body">
                <h5>Income Analysis</h5>
                <span>8% High then last month</span>
                <div class="sparkline-pie m-t-20">6,4,8</div>
                <div class="stats-report m-b-30">
                    <div class="stat-item">
                        <h5>Design</h5>
                        <b class="col-black">84.60%</b>
                    </div>
                    <div class="stat-item">
                        <h5>Dev</h5>
                        <b class="col-black">15.40%</b>
                    </div>
                    <div class="stat-item">
                        <h5>SEO</h5>
                        <b class="col-black">5.10%</b>
                    </div>
                </div>
                <span id="sparkline-compositeline">8,4,0,0,0,0,1,4,4,10,10,10,10,0,0,0,4,6,5,9,10</span>
            </div>
        </div>
    </div>
    <div class="col-lg-6 col-md-12">
        <div class="card clearfix" style="height:100%" id="group-infor-card">
            <div class="header"></div>
            <div class="body">
                <div class="tab-content">
                    <!-- TODO: Không biết để nút remove với nút tranfer owner ở đâu -->
                    <div class="tab-pane animated fadeIn show active clearfix" id="overview-tab">
                        <a class="btn-circle btn-primary-theme btn-switch-tab" style="float:right" href="#setting-tab"><i class="icon-settings"></i> Settings</a>
                        <h5>@Model.Name</h5>
                        <p>@Model.Description</p>
                        @Html.Partial("~/Views/Shared/Common/_File.cshtml", files)
                        @*<div id="uploadfile">
                                <input type="file" id="FileUpload" name="FileUpload" style="display:none" />
                                <button class="btn btn-default waves-effect" id="btn-file"><i class="icon-cloud-upload"></i> Upload</button>
                            </div>
                            <div class="table-responsive m-t-15" style="overflow-x:unset" id="file-list">
                                <table class="table table-hover">
                                    <tbody>
                                        @foreach (var file in files)
                                        {
                                            <tr>
                                                <td>@file.Name</td>
                                                <td style="text-align:center">
                                                    <a href="@Url.Action("download", "file", new { file = file.Id })" class="btn btn-primary-theme waves-effect" data-toggle="tooltip" data-placement="top" title="Download">
                                                        <i class="icon-cloud-download"></i>
                                                    </a>
                                                    <button class="btn btn-danger waves-effect btn-file-remove" data-src="@file.Id" data-toggle="tooltip" data-placement="top" title="Remove"><i class="icon-trash"></i></button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>*@

                    </div>
                    <div class="tab-pane animated fadeIn" id="setting-tab">
                        <a href="#overview-tab" class="btn-switch-tab primary-theme">&lsaquo; Back</a>
                        <div class="row clearfix">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="required" for="group-name">Group Name</label>
                                    <input type="text" class="form-control" id="group-name" placeholder="Group Name" name="@Html.NameFor(m => m.Name)">
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label for="group-description">Description</label>
                                    <textarea class="form-control" rows="7" placeholder="Write something about your task (optional)" id="group-description" name="@Html.NameFor(m => m.Description)"></textarea>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <button class="btn btn-primary-theme waves-effect" id="btn-group-save">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row clearfix display-flex">
    <div class="col-lg-8 col-md-12">
        <div class="card" style="height: 100%">
            <div class="header">
                <h2>List Process Run</h2>
                <ul class="header-dropdown">
                    <li><a class="tab_btn" href="@Url.RouteUrl("GroupControlLocalizedDefault", new { controller = "process", action = "newprocessrun", groupslug = Model.groupSlug, groupid = Model.Id })" data-toggle="tooltip" data-placement="top" title="Create New Process"><i class="fa fa-plus" aria-hidden="true"></i></a></li>
                    <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Previous"><i class="fa fa-arrow-left" aria-hidden="true"></i></a></li>
                    <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Next"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></li>
                    <li class="dropdown">
                        <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu dropdown-menu-right animated bounceIn">
                            <li><a href="javascript:void(0);">Action</a></li>
                            <li><a href="javascript:void(0);">Another Action</a></li>
                            <li><a href="javascript:void(0);">Something else</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="body process-list" style="height: 387px">
                <ul class="list-unstyled">
                    @foreach (var item in listprocess.Where(y => y.IsRun == true))
                    {
                        <a href="@Url.RouteUrl("GroupControlLocalizedDefault", new { controller = "processrun", action = "detail", processid = item.Id })">

                            <li class="media">
                                <img class="mr-3 process-avatar" src="@item.Avatar" alt="Generic placeholder image">
                                <div class="media-body">
                                    <h5 class="mt-0 mb-1">@item.Name</h5><span class="badge badge-warning">Running...</span>
                                </div>
                            </li>
                        </a>
                    }

                    @*<li class="media my-4">
                            <img class="mr-3 process-avatar" src="~/Content/images/image-gallery/1.jpg" alt="Generic placeholder image">
                            <div class="media-body">
                                <h5 class="mt-0 mb-1">List-based media object</h5><span class="badge badge-info">Ready to run</span>
                                <button class="btn btn-default waves-effect"><i class="icon-settings"></i></button>
                            </div>
                        </li>
                        <li class="media">
                            <img class="mr-3 process-avatar" src="~/Content/images/image-gallery/1.jpg" alt="Generic placeholder image">
                            <div class="media-body">
                                <h5 class="mt-0 mb-1">List-based media object</h5><span class="badge badge-success">Suceed</span>
                                <button class="btn btn-default waves-effect"><i class="icon-settings"></i></button>
                            </div>
                        </li>
                        <li class="media">
                            <img class="mr-3 process-avatar" src="~/Content/images/image-gallery/1.jpg" alt="Generic placeholder image">
                            <div class="media-body">
                                <h5 class="mt-0 mb-1">List-based media object</h5><span class="badge badge-danger">Failed</span>
                                <button class="btn btn-default waves-effect"><i class="icon-settings"></i></button>
                            </div>
                        </li>*@
                </ul>
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-12">
        <div class="card" style="height: 100%">
            <div class="header">
                <h2>Processes in group</h2>
                <ul class="header-dropdown">
                    <li><a class="tab_btn" href="@Url.RouteUrl("GroupControlLocalizedDefault", new { controller = "process", action = "newprocess", groupslug = Model.groupSlug, groupid = Model.Id })" data-toggle="tooltip" data-placement="top" title="Create New Process"><i class="fa fa-plus" aria-hidden="true"></i></a></li>
                    <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Previous"><i class="fa fa-arrow-left" aria-hidden="true"></i></a></li>
                    <li><a class="tab_btn" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="Next"><i class="fa fa-arrow-right" aria-hidden="true"></i></a></li>
                    <li class="dropdown">
                        <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu dropdown-menu-right animated bounceIn">
                            <li><a href="javascript:void(0);">Action</a></li>
                            <li><a href="javascript:void(0);">Another Action</a></li>
                            <li><a href="javascript:void(0);">Something else</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="body process-list">
                <ul class="list-unstyled">
                    @foreach (var process in listprocess.Where(x => x.IsRun == null || x.IsRun == false))
                    {
                        <a href="@Url.RouteUrl("GroupControlLocalizedDefault", new { controller = "Process", action = "ShowStep", groupslug = Model.groupSlug, groupid = Model.Id, processid = process.Id })">
                            <li class="media">

                                <div class="media-left"><img class="mr-3 process-avatar img-responsive" src="@process.Avatar" alt="@process.Name" /></div>
                                <div class="media-body">
                                    <h5 class="mt-0 mb-1">@process.Name</h5>
                                    @*<p>@pro.Description</p>*@
                                </div>
                            </li>
                        </a>
                    }
                    <li><a href="#" class="align-right displayblock primary-theme">View more...</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row clearfix">
    <div class="col-lg-8 col-md-7" id="group-c">
        <div class="card" style="padding-bottom:0">
            <div class="header">
                <h2>Members of @Model.Name</h2>
            </div>
            <div class="body" style="padding-top:0">
                <div class="table-responsive" style="overflow-x:unset">
                    <table class="table table-hover dataTable table-custom m-b-0" id="table-member" style="width:100%">
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Role</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                @if (userRole.IsAdmin || userRole.IsOwner)
                {
                    <div id="add-member-search">
                        <input type="hidden" style="width:calc(100% - 116px);border: 1px solid #ced4da;padding:5px 10px;" />
                        <button class="btn btn-primary-theme waves-effect" id="btn-add-member" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Processing" @isOwnerOrAdmin>Add member</button>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-5">
        <div class="card">
            <div class="header">
                <h2>About Owner</h2>

            </div>
            <div class="body text-center">
                <div class="profile-image m-b-15"> <img src="~/Content/images/user.png" class="rounded-circle" alt=""> </div>
                <div>
                    <h4 class="m-b-0">@Model.AspNetUser.UserName</h4>
                </div>
                <div class="m-t-15">
                    <button class="btn btn-primary-theme waves-effect">Profile</button>
                    <button class="btn btn-default waves-effect">Message</button>
                </div>
            </div>
        </div>
    </div>
</div>
@section CustomScripts{
    <script src="~/Content/build/bundles/chartist.bundle.js"></script>
    <script src="~/Content/build/bundles/knob.bundle.js"></script>
    <script src="~/Content/vendor/select2/select2.min.js"></script>
    <script src="~/Content/vendor/bootstrap-multiselect/bootstrap-multiselect.js"></script>
    <script src="~/Content/build/js/index.js"></script>
    <script src="~/Content/vendor/jquery-confirm/dist/jquery-confirm.min.js"></script>
    <script>
        $(function () {
            $(".btn-switch-tab").on("click", function (e) {
                var tab = $(this).attr("href");
                $("#group-name").val("@Model.Name");
                $("#group-description").val("@Model.Description");
                $(".tab-pane").removeClass("active").removeClass("show");
                $(tab).addClass("active").addClass("show");
                e.preventDefault();
            });
            $("#btn-group-save").on("click", function () {
                var newGroup = {
                    groupid: @Model.Id,
                    name: $("#group-name").val(),
                    description: $("#group-description").val(),
                }
                if (newGroup.name == "") {
                    showToastr("error", "Group Name is required");
                } else {
                    editGroup(newGroup);
                }
            });
            $("#table-member").DataTable({
                "lengthMenu": [5, 25, 50, 75, 100],
                "bLengthChange": false,
                "ajax": {
                    "type": "GET",
                    "url": "@Url.Action("getmemberlist", "group", new { area = "api" })",
                    "dataSrc": function (json) {
                        console.log(json);
                        json = json.data;
                        var return_data = [];
                        for (var i = 0; i < json.length; i++) {
                            var name = json[i].name;
                            var avatar;
                            var jAvatar = json[i].avatar;
                            if (jAvatar.avatar == null) {
                                avatar = `<img src="~/Content/images/xs/avatar1.jpg" class="rounded-circle width35" alt="">`;
                            } else {
                                var avatardefault = JSON.parse(jAvatar.avatardefault);
                                avatar = `<div class="width35 rounded owner-default" style="background-color:${avatardefault.background}">${avatardefault.name}</div>`
                            }
                            var member = `${avatar}${name}`;
                            var isAdmin = json[i].isAdmin ? "selected" : "";
                            var isManager = json[i].isManager ? "selected" : "";
                            if (json[i].isOwner) {
                                var role = `<select multiple="multiple" class="role multiselect" id="role-${i + 1}" data-id="${json[i].id}" disabled>
                                                <option value="o" selected>Owner</option>
                                            </select>`;
                            } else {
                                var role = `<select multiple="multiple" class="role multiselect" id="role-${i + 1}" data-id="${json[i].id}">
                                                <option value="a" ${isAdmin}>Admin</option>
                                                <option value="m" ${isManager}>Manager</option>
                                            </select>`;

                            }

                            return_data.push({
                                "member": member,
                                "sort": name,
                                "role": role,
                                "action":`<button class="btn btn-danger">Delete</button>`
                            })
                        }
                        return return_data;
                    }
                },
                "language": {
                    "emptyTable": "There aren't member in group yet",
                    "info": "Showing _START_ to _END_ of _TOTAL_ member",
                },
                "columns": [
                    {
                        "width": "35%",
                        data: {
                            _: "member",
                            sort: "sort"
                        }
                    },
                    { data: "role" },
                    { data: "action"}
                ],
                "drawCallback": function (setting) {
                    //TODO: Event update luôn fire khi ẩn thanh chọn, cần phải kiểm tra nếu thanh đổi thì mới chạy event update,không thay đổi thì thôi
                    $(".role").multiselect({
                        nonSelectedText: 'Member',
                        numberDisplayed: 4,
                        allSelectedText: false,
                        templates: { // Use the Awesome Bootstrap Checkbox structure
                            li: '<li><a href="javascript:void(0);"><label class="fancy-checkbox"><span><i></i></span></label></a></li>'
                        },
                        onDropdownHide: function (event) {
                            var id = $(this)[0].$select.attr("id");
                            var memberId = $(`#${id}`).attr("data-id");
                            var brands = $(`#${id} option:selected`);
                            let isAdmin = false, isManager = false;
                            $(brands).each(function (index, brand) {
                                var option = $(this).val();
                                if (option == "a") {
                                    isAdmin = true;
                                }
                                if (option == "m") {
                                    isManager = true;
                                }
                            });
                            var userRole = {
                                id: memberId,
                                roles: JSON.stringify({
                                    isAdmin: isAdmin,
                                    isManager: isManager
                                })
                            }
                            console.log(userRole);
                            editRole(userRole);
                        }
                    });
                    //if not admin or owner
                    @if (!userRole.IsOwner && !userRole.IsAdmin)
                    {
                        @:$("button.multiselect").addClass("disabled");
                    }else if (userRole.IsOwner)
                    {
                        @:$("select[data-id=@userRole.Id]").parents("tr").find("button.multiselect").addClass("disabled");
                    }
                    $('.multiselect-container label.checkbox').each(function () {
                        var input = $(this).find('input'),
                            val = input.val();
                        $(`<span><b><b></span>${val}`).insertAfter(input)

                    });
                    $(".page-item:not(.previous):not(.next) a").addClass("waves-effect");
                    $(".multiselect").addClass("waves-effect").css("box-shadow", "none");
                }
            });
            $("#btn-add-member").on("click", function () {
                var $this = $(this);
                toggleLoading($this);
                var newMember = $("#add-member-search input").select2("data");
                if (newMember == null) {
                    showToastr("error", "Please input name to invite user", "toast-bottom-left");
                    toggleLoading($this);
                } else {
                    addMember(newMember)
                }
            });

            $("#add-member-search input").select2({
                placeholder: "Search username, nickname, email...",
                ajax: {
                    url: "@Url.Action("getusernotingroup", "group", new { area ="api"})",

                    dataType: 'json',
                    data: function (params) {
                        var query = {
                            key: params,
                            idGroup: @Model.Id
                        }
                        return query;
                    },
                    processResults: function (data) {
                        // Tranforms the top-level key of the response object from 'items' to 'results'
                        return {
                            results: data.results
                        };
                    }
                }
            });
        });
        function editGroup(newGroup) {
            $.ajax({
                url: "@Url.Action("editgroup", "group", new { area ="api"})",
                type: "POST",
                data: newGroup,
                dataType: "json",
                success: function (response) {
                    //thanh cong thi no tra du lieu ve
                    console.log(response);
                    if (response.status == 200) {
                        window.location.reload();
                    } else {
                        showToastr("error", response.message, "toast-bottom-left")
                        console.error(response)
                    }
                }
            })

        }
        function addMember(newMember) {
            $.ajax({
                url: "@Url.Action("addmember", "group", new { area ="api"})",
                type: "POST",
                data: newMember,
                dataType: "json",
                success: function (response) {
                    //thanh cong thi no tra du lieu ve
                    console.log(response);
                    if (response.status == 200) {
                        showToastr("success", response.message, "toast-bottom-left");
                        var addButton = $("#btn-add-member");
                        toggleLoading(addButton);
                        $(".select2-chosen").empty();
                        $("#table-member").DataTable().ajax.reload();
                    } else {
                        showToastr("error", response.message, "toast-bottom-left")
                        console.error(response)
                    }
                }
            })

        }
        function editRole(role) {
            $.ajax({
                url: "@Url.Action("editrole", "group", new { area = "api"})",
                type: "POST",
                data: role,
                dataType: "json",
                success: function (response) {
                    //thanh cong thi no tra du lieu ve
                    console.log(response);
                    if (response.status == 200) {
                        showToastr("success", response.message, "toast-bottom-left");
                        $("#table-member").DataTable().ajax.reload();
                    } else {
                        showToastr("error", response.message, "toast-bottom-left")
                        console.error(response)
                    }
                }
            })
        }
    </script>
    <script>
        $(function () {
            //fileupload
            @if (maxFileSizeRule != null)
            {
                int value = maxFileSizeRule.Value;
                string unit = maxFileSizeRule.Unit.ToLower().Trim();
                int pow;
                switch (unit)
                {
                    case "kb":
                        pow = 1;
                        break;
                    case "mb":
                        pow = 2;
                        break;
                    case "gb":
                        pow = 3;
                        break;
                    default:
                        pow = 0;
                        break;
                }
                double toByte = value * Math.Pow(1024, pow);
                @:var maxFileSize = @toByte;
            }
            else
            {
                @:var maxFileSize = null;
            }
            $("#btn-file").on("click", function () {
                $("#FileUpload").trigger("click");
            });
            $(document).on("click", ".btn-file-remove", function () {
                var id = this.dataset.src;
                var fileName = $(this).parents("tr").find("td:first-child").text().trim();
                setConfirm(`Are you sure you want to delete "${fileName}"?`, function () {
                    removeFile(id);
                });
            })
            $(document).on("click", ".btn-file-changename", function () {
                var id = this.dataset.src;
                var fileName = $(this).parents("tr").find("td:first-child").text().trim();
                var dialog = $.confirm({
                    title: `Change File Name (${fileName})`,
                    content:'<div class="form-group">' +
                        '<label>Filename</label>' +
                        '<input type="text" placeholder="Enter your new file name" class="name form-control" required />' +
                        '</div>',
                    columnClass: 'medium',
                    closeIcon: true,
                    closeIconClass: 'fa fa-close',
                    buttons: {
                        save: {
                            btnClass: 'btn-none waves-effect',
                            action: function () {
                                var newFileName = this.$content.find('input').val().trim();
                                if (newFileName == "") {
                                    showToastr("error", "File Name is required");
                                } else {
                                    dialog.close();
                                    setConfirm(`Are you sure you want to change from <b>${fileName}</b> to <b>${newFileName}</b>?`, function () {
                                        changeFileName(id, newFileName);
                                    });
                                    
                                }
                                return false;
                            }
                        },
                        cancel: {
                            btnClass: 'btn-none waves-effect',
                        }
                    },
                    onContentReady: function () {
                        this.$content.find("input").val(fileName);
                    },
                });
            })
            $("#FileUpload").on("change", function () {
                //var fileName = e.target.files[0].name;
                var file = this.files[0];
                var fileName = file.name;
                var fileSize = file.size;
                if (maxFileSize != null && fileSize > maxFileSize) {
                    showToastr("error", "Your file pass our limit size rule");
                } else {
                    setConfirm(`Are you sure you want to upload "${fileName}"?`, function () {
                        addFile(file);
                    });
                }
                $(this).val("");

            });
        });
        function addFile(file) {
            var data = new FormData();
            data.append("FileUpload", file);
            data.append("groupid", @group.Id);
            data.append("direction", "@FileDirection.Group");
            $.ajax({
                url: "@Url.Action("uploadfile", "file", new { area = "api"})",
                type: "POST",
                data: data,
                contentType: false,
                processData: false,
                dataType: "json",
                success: function (response) {
                    //thanh cong thi no tra du lieu ve
                    console.log(response);
                    if (response.status == 200) {
                        showToastr("success", response.message, "toast-bottom-left");
                        var file = renderFile(response.data)
                        $("#file-list tbody").append(file);
                    } else {
                        showToastr("error", response.message, "toast-bottom-left");
                        console.error(response);
                    }
                }
            })
        }
        function removeFile(id) {
            var data = {
                id: id,
                groupid : @group.Id
            }

            $.ajax({
                url: "@Url.Action("removefile", "file", new { area = "api"})",
                type: "POST",
                data: data,
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    if (response.status == 200) {
                        showToastr("success", response.message, "toast-bottom-left");
                        $(`[data-src="${id}"]`).parents("tr").fadeOut(500, function () {
                            $(this).remove();
                        })
                    } else {
                        showToastr("error", response.message, "toast-bottom-left");
                        console.error(response);
                    }
                }
            })
        }
        function renderFile(file) {
            return `<tr>
                        <td>
                            <a href="href="/file/download/${file.id}">
                               ${file.name}
                            </a>
                        </td>
                        <td style="text-align:center">
                            <button class="btn btn-primary-theme waves-effect btn-file-changename" data-src="${file.id}" data-toggle="tooltip" data-placement="top" title="Change Name">
                                <i class=" icon-pencil"></i>
                            </button>
                            <button class="btn btn-danger waves-effect btn-file-remove" data-src="${file.id}" data-toggle="tooltip" data-placement="top" title="Remove">
                                <i class="icon-trash"></i>
                            </button>
                        </td>
                    </tr>`
            
        }
        function setConfirm(content,okfunction,cancelfunction) {
            $.confirm({
                title: 'Confirm!',
                type: 'primary-theme',
                theme: 'material',
                icon: 'fa fa-question',
                closeIcon: true,
                closeIconClass: 'fa fa-close',
                content: content,
                columnClass: 'medium',
                buttons: {
                    ok: {
                        btnClass: 'btn-none waves-effect',
                        action: okfunction
                    },
                    cancel: {
                        btnClass: 'btn-none waves-effect',
                        action: cancelfunction
                    }
                },
            });
        }
        function changeFileName(id,filename) {
            var data = {
                id: id,
                groupid: @group.Id,
                filename: filename
            }

            $.ajax({
                url: "@Url.Action("changefilename", "file", new { area = "api"})",
                type: "POST",
                data: data,
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    if (response.status == 200) {
                        showToastr("success", response.message, "toast-bottom-left");
                        $(`[data-src="${id}"]`).parents("tr").find('td:first-child a').text(response.data.name);
                    } else {
                        showToastr("error", response.message, "toast-bottom-left");
                        console.error(response);
                    }
                }
            })
        }
    </script>
}